<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÇ°Â∏ÇËµ∞ÂêëËº™Áõ§</title>
    <style>
        :root {
            --up-color: #ff4d4d;
            --down-color: #2ecc71;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --primary: #2c3e50;
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            color: #2c3e50;
        }

        .container { max-width: 900px; width: 100%; text-align: center; }

        /* Êï∏ÊìöÈù¢Êùø */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .stat-card h3 { margin: 0; font-size: 14px; color: #7f8c8d; }
        .stat-card .value { font-size: 28px; font-weight: 800; margin-top: 8px; }
        #current-price { font-size: 42px; cursor: pointer; }
        .price-up { color: var(--up-color); }
        .price-down { color: var(--down-color); }

        /* ÊâãÂãïË™øÊï¥ÂçÄ */
        .manual-control {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        .manual-control input {
            width: 80px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        .small-btn {
            padding: 5px 10px;
            font-size: 12px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Ëº™Áõ§ÂçÄÂüü */
        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 20px auto;
        }

        #wheel-canvas {
            width: 100%;
            height: 100%;
            transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1);
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1));
        }

        .pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 35px solid #2c3e50;
            z-index: 10;
        }

        .main-btns {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        button.main-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
            transition: all 0.3s;
        }

        button.reset-btn {
            background: #e67e22;
            padding: 16px 20px;
        }

        button:hover:not(:disabled) { transform: scale(1.05); }
        button:disabled { background: #bdc3c7; cursor: not-allowed; box-shadow: none; }

        .status-msg { margin-top: 15px; font-size: 18px; font-weight: bold; color: #e67e22; height: 24px; }

        /* Ê≠∑Âè≤Á¥ÄÈåÑË°® */
        .history-section {
            margin-top: 30px;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 14px; text-align: center; border-bottom: 1px solid #f1f1f1; }
        th { background: #f8f9fa; color: #7f8c8d; font-size: 14px; }
        .tag { padding: 4px 10px; border-radius: 20px; font-size: 12px; color: white; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ËÇ°Â∏ÇËµ∞ÂêëËº™Áõ§</h1>

        <div class="dashboard">
            <div class="stat-card">
                <h3>Áõ§‰∏≠ÊôÇÈñì</h3>
                <div class="value" id="current-time">09:30</div>
            </div>
            <div class="stat-card">
                <h3>ÁõÆÂâçËÇ°ÂÉπ</h3>
                <div class="value price-up" id="current-price">500</div>
                <div class="manual-control">
                    <input type="number" id="manual-price-input" placeholder="Ëá™Ë®ÇÂÉπÊ†º">
                    <button class="small-btn" onclick="setManualPrice()">Ë®≠ÂÆö</button>
                </div>
            </div>
            <div class="stat-card">
                <h3>Áï∂ÂâçËº™Ê¨°</h3>
                <div class="value" id="current-round">Á¨¨ 0 / 14 Ëº™</div>
            </div>
        </div>

        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="wheel-canvas" width="600" height="600"></canvas>
        </div>

        <div class="main-btns">
            <button id="spin-btn" class="main-btn">ÂïüÂãïËº™Áõ§</button>
            <button id="reset-btn" class="main-btn reset-btn" onclick="resetGame()">Êñ∞ÈñãÁõ§</button>
        </div>
        
        <div class="status-msg" id="status-msg"></div>

        <div class="history-section">
            <table>
                <thead>
                    <tr>
                        <th>ÊôÇÈñì</th>
                        <th>Ëß∏Áôº‰∫ã‰ª∂</th>
                        <th>Êº≤Ë∑åÂπÖ</th>
                        <th>ÁµêÁÆóËÇ°ÂÉπ</th>
                    </tr>
                </thead>
                <tbody id="history-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        // --- 1. ÈÖçÁΩÆËàáËÆäÊï∏ ---
        const totalRounds = 14;
        let gameState = {
            currentPrice: 500,
            currentRound: 0,
            history: [],
            eventPool: [],
            lastRotation: 0,
            currentTimeStr: "09:30"
        };

        const config = [
            { label: 'Â§ÆË°åÂ§ßÈôçÊÅØ', change: 1.5, color: '#e74c3c', count: 1 },
            { label: 'ÁßëÊäÄËÇ°ÁàÜÊº≤', change: 0.8, color: '#ff7675', count: 2 },
            { label: 'Â§ñË≥áÊπßÂÖ•', change: 0.5, color: '#fab1a0', count: 3 },
            { label: 'Â∞èË∑å', change: -0.2, color: '#55efc4', count: 3 },
            { label: '‰∏≠Ë∑å', change: -0.4, color: '#00b894', count: 2 },
            { label: 'Â¥©Áõ§', change: -0.9, color: '#009432', count: 1 }
        ];

        // --- 2. Â≠òÊ™îÈÇèËºØ ---
        function saveToLocal() {
            localStorage.setItem('stock_game_save', JSON.stringify(gameState));
        }

        function loadFromLocal() {
            const saved = localStorage.getItem('stock_game_save');
            if (saved) {
                gameState = JSON.parse(saved);
                renderUI();
                renderHistory();
            } else {
                initEventPool();
            }
        }

        function initEventPool() {
            let pool = [];
            config.forEach(item => {
                for(let i=0; i<item.count; i++) pool.push({...item});
            });
            for(let i=0; i<2; i++) {
                const rand = config[Math.floor(Math.random() * config.length)];
                pool.push({...rand});
            }
            // Shuffle
            for (let i = pool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pool[i], pool[j]] = [pool[j], pool[i]];
            }
            gameState.eventPool = pool;
            saveToLocal();
        }

        function resetGame() {
            if(!confirm("Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÈÄ≤Â∫¶ÈáçÊñ∞ÈñãÂßãÂóéÔºü")) return;
            localStorage.removeItem('stock_game_save');
            location.reload();
        }

        // --- 3. UI Ê∏≤Êüì ---
        const canvas = document.getElementById('wheel-canvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spin-btn');

        function renderUI() {
            document.getElementById('current-price').innerText = gameState.currentPrice;
            document.getElementById('current-time').innerText = gameState.currentTimeStr;
            document.getElementById('current-round').innerText = `Á¨¨ ${gameState.currentRound} / ${totalRounds} Ëº™`;
            
            if (gameState.currentRound >= totalRounds) {
                spinBtn.disabled = true;
                document.getElementById('status-msg').innerText = "üö® ‰ªäÊó•Áõ§Âã¢ÁµêÊùü";
            }
            // ÊÅ¢Âæ©ËΩâÁõ§ËßíÂ∫¶
            canvas.style.transform = `rotate(${gameState.lastRotation}deg)`;
        }

        function renderHistory() {
            const body = document.getElementById('history-body');
            body.innerHTML = '';
            gameState.history.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.time}</td>
                    <td><span class="tag" style="background:${item.color}">${item.label}</span></td>
                    <td style="color:${item.change >= 0 ? 'var(--up-color)' : 'var(--down-color)'}">${item.changePercent}</td>
                    <td><strong>${item.price}</strong></td>
                `;
                body.appendChild(row); // Â≠òÊ™îÈ†ÜÂ∫èÊòØËàäÂà∞Êñ∞ÔºåUI È°ØÁ§∫‰πüÊòØ‰æùÁÖßÊèíÂÖ•È†ÜÂ∫è
            });
        }

        // --- 4. Áπ™Ë£ΩËº™Áõ§ (14 Ê†º) ---
        function drawWheel() {
            const totalSlices = 14;
            const sliceAngle = (2 * Math.PI) / totalSlices;
            const centerX = 300; const centerY = 300; const radius = 290;

            gameState.eventPool.forEach((event, i) => {
                const angle = i * sliceAngle;
                ctx.beginPath();
                ctx.fillStyle = event.color;
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, angle, angle + sliceAngle);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(angle + sliceAngle / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#fff";
                ctx.font = "bold 16px Arial";
                ctx.fillText(event.label, radius - 20, 6);
                ctx.restore();
            });
        }

        // --- 5. ÊóãËΩâËàáÊâãÂãïË™øÊï¥ ---
        function setManualPrice() {
            const input = document.getElementById('manual-price-input');
            const newPrice = parseInt(input.value);
            if (!isNaN(newPrice)) {
                gameState.currentPrice = newPrice;
                document.getElementById('current-price').innerText = newPrice;
                saveToLocal();
                alert("ÂÉπÊ†ºÂ∑≤Êõ¥Êñ∞ÁÇ∫: " + newPrice);
                input.value = '';
            }
        }

        spinBtn.addEventListener('click', () => {
            if (gameState.currentRound >= totalRounds) return;

            spinBtn.disabled = true;
            const targetIndex = gameState.currentRound;
            const event = gameState.eventPool[targetIndex];
            
            const roundsToSpin = 7;
            const degreesPerSlice = 360 / 14;
            // Ë®àÁÆóËßíÂ∫¶ÔºöÁ¢∫‰øùÁõÆÊ®ôÊ†ºÂ≠êÂÅúÂú®Ê≠£‰∏äÊñπ (-90Â∫¶)
            const targetRotation = (roundsToSpin * 360) - (targetIndex * degreesPerSlice) - (degreesPerSlice / 2) - 90;
            
            // ÁñäÂä†ÊóãËΩâ
            const finalRotation = gameState.lastRotation + (360 * roundsToSpin) + (targetRotation - (gameState.lastRotation % 360));
            
            canvas.style.transform = `rotate(${finalRotation}deg)`;
            gameState.lastRotation = finalRotation;

            setTimeout(() => {
                // ÈÇèËºØË®àÁÆó
                const oldPrice = gameState.currentPrice;
                gameState.currentPrice = Math.floor(gameState.currentPrice * (1 + event.change));
                
                // ÊôÇÈñìË®àÁÆó
                let [h, m] = gameState.currentTimeStr.split(':').map(Number);
                m += 10;
                if(m >= 60) { h++; m = 0; }
                gameState.currentTimeStr = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
                
                gameState.currentRound++;

                // Á¥ÄÈåÑ
                const changePercent = event.change >= 0 ? `+${event.change * 100}%` : `${event.change * 100}%`;
                gameState.history.unshift({
                    time: gameState.currentTimeStr,
                    label: event.label,
                    color: event.color,
                    change: event.change,
                    changePercent: changePercent,
                    price: gameState.currentPrice
                });

                renderUI();
                renderHistory();
                saveToLocal();

                if (gameState.currentRound < totalRounds) {
                    spinBtn.disabled = false;
                }
            }, 4000);
        });

        // ÂàùÂßãÂåñ
        loadFromLocal();
        drawWheel();
        renderUI();
    </script>
</body>
</html>